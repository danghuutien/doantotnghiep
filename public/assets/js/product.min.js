function dataURLtoFile(e,t){for(var a=e.split(","),n=a[0].match(/:(.*?);/)[1],o=atob(a[1]),s=o.length,i=new Uint8Array(s);s--;)i[s]=o.charCodeAt(s);return new File([i],t,{type:n})}function alertTextCmt(e){alert_show("error",e)}function commentLoad(e,t,a,n,o){data={type:e,type_id:t,pageCmt:a},$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:variable.ajax_load_url,data:data,beforeSend:function(){$(".comments-loading").css({visibility:"visible",opacity:0}).animate({opacity:1},200)},success:function(e){$(".comments-loading").animate({opacity:0},200,function(){$(".comments-loading").css("visibility","hidden")}),n.closest(".comments").find(".total-comment").text(e.comment_totals),0==e.has_more?n.closest(".comments").find(".comments-loadmore").css("display","none"):n.closest(".comments").find(".comments-loadmore").css("display","block"),1==o?n.closest(".comments").find(".comments-list").empty().append(e.html):n.closest(".comments").find(".comments-list").append(e.html),n.closest(".comments").find("*[data-comments_loadmore]").data("page_cmt",a).attr("data-page_cmt",a),n.closest(".comments").find(".comments-info__filter").find("input[name=keyword]").val("")},error:function(e){$(".comments-loading").animate({opacity:0},200,function(){$(".comments-loading").css("visibility","hidden")}),alertTextCmt(variable.ajax_load_error_text)}})}function commendAdd(e,t,a,n){$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:variable.ajax_add_url,data:n,enctype:"multipart/form-data",processData:!1,contentType:!1,beforeSend:function(){loadingBox("open")},success:function(n){loadingBox("close"),2==n.status?alertTextCmt(n.message):(commentLoad(e,t,1,a,!0),a.closest(".comments").find("*[name=content]").val(""),a.closest(".comments").find("*[name=name]").val(""),a.closest(".comments").find("*[name=phone]").val(""),a.closest(".comments").find("*[name=rank]").val(""),a.closest(".comments").find("*[name=parent_id]").val(""),a.closest(".comments").find("*[name=comment_file]").val(""),a.closest(".comments").find("*[data-page_cmt]").attr("data-page_cmt",1).data("page_cmt",1),a.closest(".comments").find(".comments-add__preview").empty(),a.closest(".comments").find(".moreinfo").removeClass("open"),$("body").css("overflow","auto"))},error:function(e){loadingBox("close"),alertTextCmt(variable.ajax_load_error_text)}})}function commentSearch(e,t,a,n,o,s,i){data={type:e,type_id:t,keyword:a,pageCmt:n,sort:o},$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:variable.ajax_search_url,data:data,beforeSend:function(){loadingBox("open")},success:function(e){loadingBox("close"),0==e.has_more?s.closest(".comments").find(".comments-loadmore").css("display","none"):s.closest(".comments").find(".comments-loadmore").css("display","block"),1==i?s.closest(".comments").find(".comments-list").empty().append(e.html):s.closest(".comments").find(".comments-list").append(e.html),s.closest(".comments").find("*[data-comments_loadmore]").data("page_cmt",n).attr("data-page_cmt",n)},error:function(e){loadingBox("close"),alertTextCmt(variable.ajax_load_error_text)}})}$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$(document).ready(function(){$("body").on("click",".btn_rating",function(){$(this).parents().find(".popup_comment").toggleClass("active")}),$("body").on("click",".toggleContent",function(){$(this).parents().toggleClass("active")}),$("body").on("click",".showallproduct",function(){let e=$(".pagination__numbers .next-page").data("href");void 0!=e&&""!=e?loadData(e):$(this).remove()}),$("body .list-inline a").hover(function(e){let t=$(this).data("point");for(var a=1;a<=5;a++)a<=t?$(".list-inline a.star-"+a).addClass("active"):$(".list-inline a.star-"+a).removeClass("active")},function(){let e=$('.comments-add__vote input[name="rank"]').val();for(var t=1;t<=5;t++)t<=e?$(".list-inline a.star-"+t).addClass("active"):$(".list-inline a.star-"+t).removeClass("active")}),$("body").on("click",".list-inline a",function(e){e.preventDefault();let t=$(this).data("point");for(var a=1;a<=5;a++)a<=t?$(".list-inline a.star-"+a).addClass("active"):$(".list-inline a.star-"+a).removeClass("active");$('.comments-add__vote input[name="rank"]').val(t).change()}),$(".product_favorite .owl-carousel").owlCarousel({loop:!0,autoplay:!1,autoplayTimeout:2500,autoplayHoverPause:!0,margin:13,dots:!1,nav:!0,items:3,lazyLoad:!0,smartSpeed:1e3,navText:['<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 278.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M342.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L274.7 256 105.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z"/></svg>'],responsive:{0:{items:1},390:{items:1},576:{items:2},900:{items:2},1200:{items:3}}}),$(".product_single").length&&($(".venobox").venobox(),$(".images_list_for").slick({infinite:!1,slidesToShow:1,slidesToScroll:1,arrows:!1,fade:!0,asNavFor:".images_list_nav"}),$(".images_list_nav").slick({infinite:!1,slidesToShow:3,slidesToScroll:1,asNavFor:".images_list_for",dots:!1,focusOnSelect:!0,prevArrow:'<button class="nav nav-prev"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" width="15" height="15"><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" fill="#fff"/></svg></button>',nextArrow:'<button class="nav nav-next"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" width="15" height="15"><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z" fill="#fff"/></svg></button>',responsive:[{breakpoint:768,settings:{slidesToShow:3}},{breakpoint:480,settings:{slidesToShow:2}}]}),$("body").on("click",".view_more span",function(){$(this).parents(".detail_left__show").find(".css-content").hasClass("active")?($(this).parents(".detail_left__show").find(".css-content").removeClass("active"),$(this).empty(),$(this).append("Xem thêm")):($(this).parents(".detail_left__show").find(".css-content").addClass("active"),$(this).empty(),$(this).append("Ẩn bớt"))}),$("body").on("click",".specifications",function(){$(".specifications_popup").toggleClass("active")}),$("body").on("click",".specification_close",function(){$(this).parents(".specifications_popup").removeClass("active")})),$("body").on("click",".phone_order",function(){let e=$(this).parent().find('input[name="phone"]').val(),t=$(this).parent().find('input[name="product_id"]').val(),a=$(this);""!=e&&void 0!=e?isPhone(e)?(loadingBox("open"),$.ajax({dataType:"json",type:"POST",data:{phone:e,product_id:t},url:"/ajax/phone_order",method:"POST",success:function(e){loadingBox("close"),a.parent().find('input[name="phone"]').val(""),alert_show(type="success","Thành công! Chúng tôi sẽ gọi lại cho bạn!")},error:function(){loadingBox("close"),alert_show(type="error","Có lỗi xảy ra!")}}),$(".phone").val("")):(alert_show(type="error","Số điện thoại của bạn không đúng định dạng!"),$(".phone").val("")):alert_show(type="error","Bạn chưa điền số điện thoại!")}),$(".lang_comments").length&&(variable=$(".lang_comments").data("value"),variable=atob(variable),variable=JSON.parse(variable)),content=null,file_data=null,parent_id=null,$("body").on("click",".comments *[data-comments_submit]",function(e){e.preventDefault(),e.stopImmediatePropagation(),comments=$(this).closest(".comments"),type=comments.data("type"),type_id=comments.data("type_id"),name=$(this).closest(".comments-add").find("*[name=name]").val(),phone=$(this).closest(".comments-add").find("*[name=phone]").val(),vote=$(this).closest(".comments-add").find("*[name=rank]").val(),content=$(this).closest(".comments-add").find("*[name=content]").val(),parent_id=$(this).data("comment_id"),""==content||""==name||""==phone||void 0==content||void 0==name||void 0==phone?alertTextCmt(variable.valid_empty):isPhone(phone)?""==vote||void 0==vote?alertTextCmt("Vui lòng chọn số sao đánh giá!"):(form_data=new FormData,form_data.append("type",type),form_data.append("type_id",type_id),form_data.append("content",content),form_data.append("name",name),form_data.append("phone",phone),form_data.append("vote",vote),form_data.append("parent_id",parent_id),$(".comments .comments-add__preview .image").each(function(){let e=$(this).find("input");form_data.append("files[]",e[0].files[0])}),commendAdd(type,type_id,$(this),form_data)):alertTextCmt(variable.valid_format_phone)}),$("body").on("click",".votes_form__btn",function(){$(this).hasClass("active")?$(this).find("a").text("Gửi đánh giá của bạn"):$(this).find("a").text("Hủy"),$(this).toggleClass("active"),$(this).closest(".comments").find(".comments-add").slideToggle()}),$("body").on("click",".comments .popup-image",function(e){e.preventDefault(),e.stopImmediatePropagation(),src=$(this).data("image"),$(this).closest(".comments").find(".previews").find(".comments-popup__body").find("img").attr("src",src),$(this).closest(".comments").find(".previews").addClass("open"),$("body").css("overflow","hidden")}),$("body").on("change","input[name=comment_file]",function(e){e.preventDefault(),file=this.files,check_extention=0,allowed_size=variable.allowed_size,allowed_extention=["jpg","jpeg","png"];let t=0;$(this).closest(".comments-add").find(".comments-add__preview").empty().change(),$.each(file,function(e,a){if(a.size>allowed_size&&(check_size=1),-1==$.inArray(a.name.split(".").pop().toLowerCase(),allowed_extention))check_extention=1;else{image_preview=URL.createObjectURL(a);let e=`<div class="image">\n                    <img src="${image_preview}">\n                    <input type="file" name="image[]" id="upload_${t}" style="display: none;">\n                </div>`;$(".comments-add").find(".comments-add__preview").append(e);let n=document.querySelector("input#upload_"+t),o=new ClipboardEvent("").clipboardData||new DataTransfer;a.size>512e3||a.fileSize>512e3?resizeImage(a,{use_reader:!1,mode:2,val:400,type:"image/jpeg",quality:.8,callback:function(e){let t=dataURLtoFile(e,a.name);o.items.add(t),n.files=o.files}}):(o.items.add(a),n.files=o.files),t++}}),1==check_extention&&alertTextCmt(variable.valid_extention+" "+allowed_extention.join(", "))}),$("body").on("click",".comments *[data-comments_loadmore]",function(e){e.preventDefault(),e.stopImmediatePropagation(),type=$(this).closest(".comments").data("type"),type_id=$(this).closest(".comments").data("type_id"),pageCmt=parseInt($(this).data("page_cmt")),pageCmt+=1,commentSearch(type,type_id,null,pageCmt,$(".comments .page-header__short select").val(),$(this),!1)}),$("body").on("change",".comments .page-header__short select",function(e){e.preventDefault(),e.stopImmediatePropagation(),type=$(this).closest(".comments").data("type"),type_id=$(this).closest(".comments").data("type_id"),pageCmt=1;let t=$(this).val();commentSearch(type,type_id,null,pageCmt,t,$(this),!0)}),start=null,$("body").on("click",".comments *[data-reply]",function(e){e.preventDefault(),e.stopImmediatePropagation(),item=$(this).closest(".item[data-comment_id]"),tags=$(this).data("reply"),$(".item-reply").find(".comments-add").css("display","none"),$(".comments-add__moreinfo").css("display","none"),item.find(".item-reply").find(".comments-add").slideDown(),item.find(".item-reply").find(".comments-add").find(".comments-add__form-field").val(tags)}),$("body").on("click",".comments *[data-comments_moreinfo]",function(e){e.preventDefault(),e.stopImmediatePropagation(),$(this).closest(".comments").find(".moreinfo").addClass("open"),$("body").css("overflow","hidden"),content=$(this).closest(".comments-add").find("*[name=content]").val(),parent_id=$(this).data("comment_id"),1==variable.upload_image&&(file_data=$(this).closest(".comments-add").find("*[name=comment_file]").prop("files"))}),$("body").on("click",".comments *[data-comments_close]",function(e){e.preventDefault(),e.stopImmediatePropagation(),$(this).closest(".comments-popup").removeClass("open"),$("body").css("overflow","auto"),content=null,file_data=null,parent_id=null})}),$("#relate_products .owl-carousel").owlCarousel({loop:!1,autoplay:!0,autoplayTimeout:4e3,autoplayHoverPause:!0,margin:13,dots:!1,nav:!0,items:3,lazyLoad:!0,smartSpeed:1e3,navText:['<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 278.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M342.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L274.7 256 105.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z"/></svg>'],responsive:{0:{items:1},390:{items:1},576:{items:2},900:{items:2},1200:{items:3}}}),$(".checkbox-module .filter-parent").click(function(){$(".checkbox-module .filter-parent").each(function(e,t){$(t).find(".box-filter__detail").removeClass("active")}),$(this).find(".box-filter__detail").addClass("active"),$(this).parent().find("#overlay_filter").addClass("active")}),$(".checkbox-module #overlay_filter").click(function(){$(this).removeClass("active"),$(this).parent().find(".box-filter__detail").removeClass("active")});